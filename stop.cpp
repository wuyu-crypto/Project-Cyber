//=============================================================================
//
// ストップエフェクト [stop.cpp]
// Author : GP11B132 33 呉優
//
//=============================================================================
#include "stop.h"
#include "sound.h"

//*****************************************************************************
// マクロ定義
//*****************************************************************************
#define			DEFAULT_FRAME_NUM		30		// ストップエフェクトのデフォルト実行フレーム数

//*****************************************************************************
// プロトタイプ宣言
//*****************************************************************************

//*****************************************************************************
// グローバル変数
//*****************************************************************************
static BOOL		g_Load = FALSE;			// 初期化を行ったかのフラグ

static int		g_FrameCnt;				// フレームカウンタ
static int		g_FrameNum;				// 実行するフレーム数

//=============================================================================
// 初期化処理
//=============================================================================
HRESULT InitStop(void)
{
	g_FrameCnt = 0;
	g_FrameNum = 0;

	g_Load = TRUE;
	return S_OK;

}

//=============================================================================
// 終了処理
//=============================================================================
void UninitStop(void)
{
	if (g_Load == FALSE) return;

	g_Load = FALSE;
}

//=============================================================================
// 更新処理
//=============================================================================
void UpdateStop(void) {

	g_FrameCnt++;

	if (g_FrameCnt == g_FrameNum) {

		PlaySound(SOUND_LABEL_SE_EXPLOSION002);
		SetModeWithoutReload(MODE_GAME);
	}

}

//=============================================================================
// ストップエフェクトをセット
//=============================================================================
void SetStop(int frameNum) {
	
	// NULLならデフォルトフレーム数をセット
	if (frameNum == NULL) {
		g_FrameNum = DEFAULT_FRAME_NUM;
	}

	// フレーム数をセット
	else {
		g_FrameNum = frameNum;
	}

	SetModeWithoutReload(MODE_GAME_STOP);
}